# Linera Edge - dApp æ’åé¢„æµ‹ä¸ç§¯åˆ†æŠ•æ³¨åº”ç”¨

ä¸€ä¸ªåŸºäº Linera åŒºå—é“¾çš„å»ä¸­å¿ƒåŒ– dApp æ’åé¢„æµ‹å’Œç§¯åˆ†æŠ•æ³¨å¹³å°ï¼Œæ”¯æŒä¸­è‹±æ–‡å›½é™…åŒ–ç•Œé¢ã€‚

## ğŸŒŸ é¡¹ç›®æ¦‚è¿°

**Linera Edge** å…è®¸ç”¨æˆ·å¯¹ Linera ç”Ÿæ€ä¸­çš„ dApp è¿›è¡Œç§¯åˆ†æŠ•æ³¨ï¼Œé¢„æµ‹å…¶æ’åï¼Œå¹¶é€šè¿‡ç«äº‰æ€§å¥–åŠ±æœºåˆ¶è·å¾—æ”¶ç›Šã€‚å¹³å°é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **ç§¯åˆ†ç³»ç»Ÿ**: æ¯ä¸ªç”¨æˆ·é¦–æ¬¡äº¤äº’è·å¾— 100 ç§¯åˆ†
- **æŠ•æ³¨æœºåˆ¶**: å¯¹ä»»æ„ dApp è¿›è¡Œç§¯åˆ†æŠ•æ³¨
- **èµå›åŠŸèƒ½**: éšæ—¶èµå›æŠ•æ³¨æœ¬é‡‘ï¼ˆæ‰£é™¤ 1% æ‰‹ç»­è´¹ï¼Œå‘ä¸Šå–æ•´ï¼Œæœ€ä½ 1 ç§¯åˆ†ï¼‰
- **è‡ªåŠ¨ç»“ç®—**: æ¯åˆ†é’Ÿè‡ªåŠ¨åˆ†é…å¥–åŠ±ç»™å‰ 10 å dApp çš„æ”¯æŒè€…
- **å®æ—¶æ’è¡Œ**: å®æ—¶æŸ¥çœ‹ dApp æ’åå’ŒæŠ•æ³¨æ•°æ®
- **ç”¨æˆ·æ’è¡Œæ¦œ**: æŸ¥çœ‹ç”¨æˆ·æ”¶ç›Šæ’è¡Œæ¦œ
- **å›½é™…åŒ–æ”¯æŒ**: ä¸­è‹±æ–‡ç•Œé¢åˆ‡æ¢
- **æƒé™ç®¡ç†**: åªæœ‰ç™½åå•ç”¨æˆ·å¯ä»¥ç®¡ç†åº”ç”¨

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### 1. ç§¯åˆ†ç³»ç»Ÿ
- é¦–æ¬¡äº¤äº’è‡ªåŠ¨è·å¾— 100 ç§¯åˆ†
- ç§¯åˆ†ç”¨äºæŠ•æ³¨ï¼Œä¸èƒ½ç›´æ¥æç°
- å•ä¸ª dApp æŠ•æ³¨ä¸Šé™ 100 ç§¯åˆ†

### 2. æŠ•æ³¨åŠŸèƒ½
- å¯¹ä»»æ„ Linera ç”Ÿæ€ dApp è¿›è¡ŒæŠ•æ³¨
- å®æ—¶æ›´æ–° dApp æ€»æŠ•æ³¨é¢å’Œç”¨æˆ·ä¸ªäººè®°å½•
- æŠ•æ³¨é‡‘é¢å¿…é¡»ä¸ºæ­£æ•´æ•° â‰¥1

### 3. èµå›åŠŸèƒ½
- éšæ—¶éƒ¨åˆ†/å…¨éƒ¨èµå›æŠ•æ³¨æœ¬é‡‘
- 1% æ‰‹ç»­è´¹è¿›å…¥å¹³å°å¥–æ± ï¼ˆå‘ä¸Šå–æ•´ï¼Œæœ€ä½ 1 ç§¯åˆ†ï¼‰
- èµå›é‡‘é¢æ‰£é™¤æ‰‹ç»­è´¹åè¿”è¿˜ç”¨æˆ·ä½™é¢
- èµå›é‡‘é¢å¿…é¡»ä¸ºæ­£æ•´æ•° â‰¥1

### 4. ç»“ç®—æœºåˆ¶
- æ¯åˆ†é’Ÿè‡ªåŠ¨ç»“ç®—ä¸€æ¬¡ï¼ˆç”±å®šæ—¶è„šæœ¬è§¦å‘ï¼‰
- å‰ 10 å dApp çš„æ”¯æŒè€…è·å¾—å¥–åŠ±
- å¹³å°å¥–æ±  10% ç”¨äºåˆ†é…
- å›ºå®šæƒé‡æ¯”ä¾‹ï¼š15%, 14%, 13%, 12%, 11%, 10%, 9%, 8%, 7%, 6%
- æ”¯æŒäººæ•° bonus æœºåˆ¶ï¼šæ¯å¢åŠ ä¸€åæ”¯æŒè€…ï¼Œå¥–åŠ±å¢åŠ  10%ï¼Œæœ€é«˜ 100%
- å¢é•¿ bonus æœºåˆ¶ï¼šæ’å 5-10 çš„åº”ç”¨é¢å¤–è·å¾— 5-25% å¥–åŠ±
- æ–°åº”ç”¨ bonus æœºåˆ¶ï¼šä¸Šçº¿ 7 å¤©å†…çš„åº”ç”¨é¢å¤–è·å¾— 20% å¥–åŠ±

### 5. æŸ¥è¯¢åŠŸèƒ½
- ç”¨æˆ·ä½™é¢æŸ¥è¯¢
- ç”¨æˆ·æŠ•æ³¨è®°å½•æŸ¥è¯¢
- dApp æ€»æŠ•æ³¨é¢æŸ¥è¯¢
- å‰ N å dApp æ’è¡ŒæŸ¥è¯¢
- å¹³å°å¥–æ± é‡‘é¢æŸ¥è¯¢

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **åç«¯**: Rust + Linera SDK + GraphQL
- **å‰ç«¯**: React + TypeScript + Tailwind CSS + Apollo Client
- **çŠ¶æ€ç®¡ç†**: Linera Views (MapView, RegisterView) + React Context
- **æŸ¥è¯¢æ¥å£**: GraphQL API
- **å­˜å‚¨**: é“¾ä¸ŠçŠ¶æ€å­˜å‚¨
- **å›½é™…åŒ–**: react-i18next

### æ ¸å¿ƒç»„ä»¶
- **åç«¯**:
  - `contract.rs`: æ™ºèƒ½åˆçº¦å®ç°
  - `service.rs`: GraphQL æœåŠ¡å®ç°
  - `state.rs`: çŠ¶æ€ç®¡ç†
  - `types.rs`: æ•°æ®ç±»å‹å®šä¹‰
- **å‰ç«¯**:
  - `src/pages/`: React é¡µé¢ç»„ä»¶
  - `src/components/`: é€šç”¨ UI ç»„ä»¶
  - `src/services/`: GraphQL å®¢æˆ·ç«¯å’Œä¸šåŠ¡é€»è¾‘
  - `src/context/`: React Context çŠ¶æ€ç®¡ç†
  - `src/i18n.ts`: å›½é™…åŒ–é…ç½®
  - `run_settlement.js`: è‡ªåŠ¨ç»“ç®—è„šæœ¬

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èæ–¹å¼ï¼šä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬
```bash
cd examples/Linera-edge
chmod +x install.sh
./install.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š**
- æ„å»ºåç«¯ WASM æ¨¡å—
- å‘å¸ƒæ¨¡å—åˆ° Linera ç½‘ç»œ
- åˆ›å»ºåº”ç”¨
- é…ç½®å‰ç«¯ç¯å¢ƒå˜é‡
- å®‰è£…å‰ç«¯ä¾èµ–
- å¯åŠ¨ GraphQL æœåŠ¡ï¼ˆç«¯å£ 8080ï¼‰
- å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 3000ï¼‰
- å¯åŠ¨è‡ªåŠ¨ç»“ç®—è„šæœ¬ï¼ˆæ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼‰

**å®‰è£…å®Œæˆåï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºï¼š**
- åº”ç”¨ ID
- é“¾ ID
- å‰ç«¯è®¿é—®åœ°å€
- GraphQL API ç«¯ç‚¹

### æ‰‹åŠ¨æ–¹å¼ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

#### 1. æ„å»ºåç«¯åº”ç”¨
```bash
cd examples/Linera-edge
cargo build --release --target wasm32-unknown-unknown
```

#### 2. éƒ¨ç½²åç«¯åº”ç”¨
```bash
# å‘å¸ƒæ¨¡å—
linera publish-module target/wasm32-unknown-unknown/release/linera_edge_{contract,service}.wasm

# åˆ›å»ºåº”ç”¨
linera create-application <MODULE_ID> <CHAIN_ID> --json-argument "{}"
```

#### 3. å¯åŠ¨ GraphQL æœåŠ¡
```bash
linera service --port 8080
```

#### 4. é…ç½®å‰ç«¯ç¯å¢ƒ
```bash
cd examples/Linera-edge/web-frontend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™ç›¸å…³é…ç½®
```

#### 5. å®‰è£…å‰ç«¯ä¾èµ–
```bash
cd examples/Linera-edge/web-frontend
npm install
```

#### 6. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```bash
cd examples/Linera-edge/web-frontend
npm run dev
```

#### 7. å¯åŠ¨è‡ªåŠ¨ç»“ç®—è„šæœ¬
```bash
cd examples/Linera-edge/web-frontend
npm run settlement
```

## ğŸ“Š GraphQL API

### æŸ¥è¯¢æ¥å£
```graphql
# æŸ¥è¯¢ç”¨æˆ·ä½™é¢
query GetBalance($owner: AccountOwner) {
  getBalance(owner: $owner)
}

# æŸ¥è¯¢ç”¨æˆ·æŠ•æ³¨è®°å½•
query GetUserBets($owner: AccountOwner) {
  getUserBets(owner: $owner) {
    appId
    amount
    timestamp
  }
}

# æŸ¥è¯¢ dApp æ€»æŠ•æ³¨é¢
query GetAppTotalBet($appId: String!) {
  getAppTotalBet(appId: $appId)
}

# æŸ¥è¯¢å‰ N å dApp
query GetTopApps($limit: Int) {
  getTopApps(limit: $limit) {
    appId
    name
    totalBet
    rank
    supporters
  }
}

# æŸ¥è¯¢å¹³å°å¥–æ± 
query GetPoolAmount {
  getPoolAmount
}

# æŸ¥è¯¢æ´»è·ƒç”¨æˆ·æ•°
query GetActiveUsersCount {
  getActiveUsersCount
}

# æŸ¥è¯¢æœ€åç»“ç®—æ—¶é—´
query GetLastSettleTime {
  getLastSettleTime
}

# æŸ¥è¯¢æ‰€æœ‰å¯æŠ•æ³¨ dApp
query GetAllAppsForBetting {
  getAllAppsForBetting {
    appId
    name
    totalBet
    rank
    supporters
  }
}

# æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦åœ¨ç™½åå•ä¸­
query IsWhitelisted($address: AccountOwner!) {
  isWhitelisted(address: $address)
}

# æŸ¥è¯¢æ¯æ—¥æ’è¡Œæ¦œ
query GetDailyLeaderboard($limit: Int) {
  getDailyLeaderboard(limit: $limit) {
    user
    earnings
    rank
  }
}

# æŸ¥è¯¢æ¯å‘¨æ’è¡Œæ¦œ
query GetWeeklyLeaderboard($limit: Int) {
  getWeeklyLeaderboard(limit: $limit) {
    user
    earnings
    rank
  }
}

# æŸ¥è¯¢æ¯æœˆæ’è¡Œæ¦œ
query GetMonthlyLeaderboard($limit: Int) {
  getMonthlyLeaderboard(limit: $limit) {
    user
    earnings
    rank
  }
}
```

### æ“ä½œæ¥å£
```graphql
# æŠ•æ³¨æ“ä½œ
mutation PlaceBet($caller: AccountOwner!, $appId: String!, $amount: Int!) {
  placeBet(caller: $caller, appId: $appId, amount: $amount)
}

# èµå›æ“ä½œ  
mutation RedeemBet($caller: AccountOwner!, $appId: String!, $amount: Int!) {
  redeemBet(caller: $caller, appId: $appId, amount: $amount)
}

# ç»“ç®—æ“ä½œï¼ˆä»…ç™½åå•ç”¨æˆ·ï¼‰
mutation Settle($caller: AccountOwner!) {
  settle(caller: $caller)
}

# æ·»åŠ åº”ç”¨ï¼ˆä»…ç™½åå•ç”¨æˆ·ï¼‰
mutation AddApplication($caller: AccountOwner!, $appId: String!, $name: String!, $description: String!) {
  addApplication(caller: $caller, appId: $appId, name: $name, description: $description)
}

# ç§»é™¤åº”ç”¨ï¼ˆä»…ç™½åå•ç”¨æˆ·ï¼‰
mutation RemoveApplication($caller: AccountOwner!, $appId: String!) {
  removeApplication(caller: $caller, appId: $appId)
}
```

## ğŸ”’ æƒé™ä¸å®‰å…¨

- **ç™½åå•ç”¨æˆ·**: åªæœ‰ç™½åå•ä¸­çš„ç”¨æˆ·å¯ä»¥ç®¡ç†åº”ç”¨å’Œè§¦å‘ç»“ç®—
- **ç”¨æˆ·æƒé™**: æ‰€æœ‰ç”¨æˆ·å¯æŠ•æ³¨å’Œèµå›è‡ªå·±çš„ç§¯åˆ†
- **å®‰å…¨éªŒè¯**: æ‰€æœ‰æ“ä½œéƒ½ç»è¿‡é“¾ä¸ŠéªŒè¯
- **åœ°å€æ ¼å¼**: æ”¯æŒå¸¦ 0x å‰ç¼€å’Œä¸å¸¦å‰ç¼€çš„åœ°å€æ ¼å¼
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰é‡‘é¢å¿…é¡»ä¸ºæ­£æ•´æ•° â‰¥1

## ğŸ”® æœªæ¥æ‰©å±•

- ä½¿ç”¨çœŸå® ApplicationId æ›¿æ¢ String app_id
- æ·»åŠ å¤šå¸‚åœºæ”¯æŒ
- å®æ—¶æ¨é€é€šçŸ¥
- è‡ªåŠ¨ oracle ç»“ç®—
- ä¸ªäººæ’åç³»ç»Ÿ
- æ·»åŠ æ›´å¤šè¯­è¨€æ”¯æŒ
- å®ç°ç§»åŠ¨ç«¯é€‚é…
- æ·»åŠ ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- é›†æˆæ›´å¤šé’±åŒ…ç±»å‹
- å®ç°æ›´å¤æ‚çš„å¥–åŠ±æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ Linera å®˜æ–¹æ–‡æ¡£æˆ–æäº¤ issueã€‚